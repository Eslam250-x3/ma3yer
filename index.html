<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>الدليل التفاعلي الكامل لمحول الأسئلة الذكي</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Tajawal', sans-serif;
            background-color: #f8fafc;
        }
        html[lang="en"] body {
            font-family: 'Inter', sans-serif;
        }
        .gradient-text {
            background: linear-gradient(135deg, #4f46e5, #a855f7);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .tab-btn.active {
            border-color: #6d28d9;
            background-color: #ede9fe;
            color: #6d28d9;
            font-weight: 700;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease-in-out;
        }
        .prompt-code {
            position: relative;
        }
        .copy-btn {
            position: absolute;
            top: 12px;
            left: 12px;
            background-color: rgba(255, 255, 255, 0.1);
            color: #e2e8f0;
            border: 1px solid #475569;
            padding: 6px 10px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            backdrop-filter: blur(5px);
            display: flex;
            align-items: center;
            gap: 4px;
        }
        html[dir="ltr"] .copy-btn {
            left: auto;
            right: 12px;
        }
        .copy-btn:hover {
            background-color: rgba(255, 255, 255, 0.2);
            border-color: #94a3b8;
        }
        .accordion-header.active .accordion-icon {
            transform: rotate(180deg);
        }
        .prose {
            line-height: 1.7;
        }
        .prose ul {
            list-style-position: inside;
            padding-right: 1rem;
        }
        html[lang="en"] .prose ul {
            padding-right: 0;
            padding-left: 1rem;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .glow-card {
            box-shadow: 0 4px 20px rgba(79, 70, 229, 0.15);
            transition: all 0.3s ease;
        }
        .glow-card:hover {
            box-shadow: 0 8px 30px rgba(79, 70, 229, 0.25);
            transform: translateY(-2px);
        }
        .wave-bg {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            overflow: hidden;
            line-height: 0;
            z-index: -1;
        }
        .wave-bg svg {
            position: relative;
            display: block;
            width: calc(100% + 1.3px);
            height: 150px;
        }
        .wave-bg .shape-fill {
            fill: rgba(79, 70, 229, 0.05);
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 relative">
    <div class="wave-bg">
        <svg data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 120" preserveAspectRatio="none">
            <path d="M321.39,56.44c58-10.79,114.16-30.13,172-41.86,82.39-16.72,168.19-17.73,250.45-.39C823.78,31,906.67,72,985.66,92.83c70.05,18.48,146.53,26.09,214.34,3V0H0V27.35A600.21,600.21,0,0,0,321.39,56.44Z" class="shape-fill"></path>
        </svg>
    </div>
    
    <div class="container mx-auto p-4 sm:p-6 lg:p-8 max-w-7xl">
        <!-- Header -->
        <header class="text-center mb-12 relative">
            <button id="lang-switcher" class="absolute top-0 right-0 bg-white border-2 border-purple-200 text-purple-700 font-bold py-2 px-4 rounded-lg hover:bg-purple-50 transition-colors duration-300 flex items-center gap-2">
                <i class="fas fa-language"></i>
                <span>English</span>
            </button>
            <div class="inline-block bg-gradient-to-r from-purple-500 to-pink-500 p-1 rounded-full mb-6">
                <div class="bg-white p-1 rounded-full">
                    <i class="fas fa-robot text-4xl bg-gradient-to-r from-purple-500 to-pink-500 bg-clip-text text-transparent"></i>
                </div>
            </div>
            <h1 id="main-title" class="text-4xl md:text-6xl font-extrabold gradient-text mb-4">
                <!-- Populated by JS -->
            </h1>
            <p id="main-subtitle" class="text-lg md:text-xl text-slate-600 max-w-3xl mx-auto">
                <!-- Populated by JS -->
            </p>
        </header>

        <!-- Tabs Navigation -->
        <div class="mb-8 bg-white p-2 rounded-xl shadow-md border border-slate-200 glow-card">
            <nav id="tabs" class="grid grid-cols-2 lg:grid-cols-5 gap-2">
                <!-- Tab buttons will be populated by JS -->
            </nav>
        </div>

        <!-- Tabs Content -->
        <main id="tab-contents">
            <!-- Guide Tab -->
            <div id="guide" class="tab-content active space-y-8">
                <div class="bg-white p-6 rounded-2xl shadow-lg border border-slate-200 glow-card">
                    <h2 id="guide-title-1" class="text-3xl font-bold mb-6 text-purple-800 flex items-center gap-3"></h2>
                    <div id="accordion-container" class="space-y-3"></div>
                </div>
                <div class="bg-white p-6 rounded-2xl shadow-lg border border-slate-200 glow-card">
                    <h2 id="guide-title-2" class="text-3xl font-bold mb-6 text-purple-800 flex items-center gap-3"></h2>
                    <div class="overflow-x-auto">
                        <table class="w-full text-right border-collapse">
                            <thead id="tags-table-head"></thead>
                            <tbody id="tags-table-body"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Workflow Tab -->
            <div id="workflow" class="tab-content">
                <div class="bg-white p-6 rounded-2xl shadow-lg border border-slate-200 glow-card">
                    <h2 id="workflow-title" class="text-3xl font-bold mb-6 text-purple-800"></h2>
                    <div class="space-y-8" id="workflow-container"></div>
                </div>
            </div>

            <!-- Advanced Tab -->
            <div id="advanced" class="tab-content">
                <div class="bg-white p-6 rounded-2xl shadow-lg border border-slate-200 glow-card">
                    <h2 id="advanced-title" class="text-3xl font-bold mb-6 text-purple-800"></h2>
                    <div class="space-y-4" id="advanced-accordion"></div>
                </div>
            </div>

            <!-- Prompts Tab -->
            <div id="prompts" class="tab-content space-y-8">
                <div class="bg-white p-6 rounded-2xl shadow-lg border border-slate-200 glow-card">
                    <h2 id="prompts-title-1" class="text-3xl font-bold mb-2 text-purple-800"></h2>
                    <p id="prompts-subtitle-1" class="mb-4 text-slate-600"></p>
                    <div id="master-prompt-container"></div>
                </div>
                <div class="bg-white p-6 rounded-2xl shadow-lg border border-slate-200 glow-card">
                    <h2 id="prompts-title-2" class="text-3xl font-bold mb-2 text-purple-800"></h2>
                    <p id="prompts-subtitle-2" class="mb-4 text-slate-600"></p>
                    <div class="grid md:grid-cols-2 gap-6" id="specific-prompts-container"></div>
                </div>
            </div>

            <!-- FAQ Tab -->
            <div id="faq" class="tab-content">
                <div class="bg-white p-6 rounded-2xl shadow-lg border border-slate-200 glow-card">
                    <h2 id="faq-title" class="text-3xl font-bold mb-6 text-purple-800"></h2>
                    <div class="space-y-4" id="faq-container"></div>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="text-center mt-12 text-slate-500">
            <div class="flex justify-center gap-4 mb-4">
                <a href="#" class="text-purple-600 hover:text-purple-800"><i class="fab fa-twitter"></i></a>
                <a href="#" class="text-purple-600 hover:text-purple-800"><i class="fab fa-github"></i></a>
                <a href="#" class="text-purple-600 hover:text-purple-800"><i class="fab fa-linkedin"></i></a>
            </div>
            <p id="footer-p1"></p>
            <p id="footer-p2"></p>
        </footer>
    </div>

    <script>
        // --- DATA & TRANSLATIONS ---
        const questionTypes = [
            { id: 'mcq', name: '1. سؤال الاختيار من متعدد (MCQ)', desc: 'يُستخدم عندما يكون هناك إجابة صحيحة واحدة فقط من بين عدة خيارات.', format: 'type: mcq\n[STEM]\nنص السؤال...\n[CHOICES]\n* الإجابة الصحيحة\n- إجابة خاطئة', exampleSimple: 'type: mcq\n[STEM]\nفي أي قارة تقع مصر؟\n[CHOICES]\n- آسيا\n* أفريقيا\n- أوروبا', exampleLesson: 'type: mcq\n[STEM]\nما هي الصيغة العامة للدالة التربيعية؟\n[CHOICES]\n- f(x) = ax + b\n* f(x) = ax² + bx + c\n- f(x) = a/x' },
            { id: 'mrq', name: '2. سؤال الإجابات المتعددة (MRQ)', desc: 'يُستخدم عندما يمكن أن يكون هناك أكثر من إجابة صحيحة واحدة.', format: 'type: mrq\n[STEM]\nنص السؤال...\n[CHOICES]\n* إجابة صحيحة 1\n- إجابة خاطئة\n* إجابة صحيحة 2', exampleSimple: 'type: mrq\n[STEM]\nاختر الفواكه:\n[CHOICES]\n* تفاح\n* موز\n- جزر', exampleLesson: 'type: mrq\n[STEM]\nما هي خصائص الدالة التربيعية؟\n[CHOICES]\n* لها قمة أو قاع\n- دائمًا تصاعدية\n* تتقاطع مع المحور y مرة واحدة' },
            { id: 'matching', name: '3. سؤال التوصيل (Matching)', desc: 'يُستخدم للربط بين عناصر في مجموعتين.', format: 'type: matching\n[STEM]\nنص السؤال...\n[MATCHING_PAIRS]\nعنصر 1 | ارتباطه الصحيح', exampleSimple: 'type: matching\n[STEM]\nصل الحيوانات بأصواتها:\n[MATCHING_PAIRS]\nكلب | نباح\nقط | مواء', exampleLesson: 'type: matching\n[STEM]\nصل الدالة بوصفها:\n[MATCHING_PAIRS]\nf(x)=x² | تربيعية\nf(x)=2x | خطية' },
            { id: 'gapText', name: '4. سؤال ملء الفراغات (Gap Text)', desc: 'يُستخدم لاختبار معرفة كلمات محددة داخل سياق.', format: 'type: gapText\n[STEM]\nالنص يحتوي على [BLANK]...\n[GAPS]\nالإجابة الصحيحة', exampleSimple: 'type: gapText\n[STEM]\nالشمس [BLANK] في السماء.\n[GAPS]\nتشرق', exampleLesson: 'type: gapText\n[STEM]\nالدالة f(x) = x² + [BLANK] x + 4 لها جذور [BLANK].\n[GAPS]\n4\nحقيقية ومتساوية' },
            { id: 'oq', name: '5. سؤال الترتيب (Ordering)', desc: 'يُستخدم لترتيب مجموعة من العناصر وفقاً لمعيار معين.', format: 'type: oq\n[STEM]\nنص السؤال...\n[CHOICES]\n- العنصر الأول بالترتيب\n- العنصر الثاني بالترتيب', exampleSimple: 'type: oq\n[STEM]\nرتب الأرقام تصاعدياً:\n[CHOICES]\n- 1\n- 2\n- 3', exampleLesson: 'type: oq\n[STEM]\nرتب خطوات حل الدالة التربيعية:\n[CHOICES]\n- حساب المميز\n- حساب الجذور\n- رسم المنحنى' },
            { id: 'string', name: '6. سؤال الإجابة النصية القصيرة (String)', desc: 'للأسئلة التي تتطلب إجابة قصيرة ومحددة جداً.', format: 'type: string\n[STEM]\nنص السؤال...\n[ANSWER]\nالإجابة الدقيقة', exampleSimple: 'type: string\n[STEM]\nما اسم كوكبنا؟\n[ANSWER]\nالأرض', exampleLesson: 'type: string\n[STEM]\nما هو معامل a في f(x)=3x²؟\n[ANSWER]\n3' },
            { id: 'frq', name: '7. سؤال الإجابة الحرة (FRQ)', desc: 'للأسئلة المقالية التي تتطلب إجابة طويلة ومفصلة.', format: 'type: frq\n[STEM]\nنص السؤال...\n[ANSWER]\nالإجابة النموذجية', exampleSimple: 'type: frq\n[STEM]\nصف الطقس اليوم.\n[ANSWER]\nمشمس ودافئ.', exampleLesson: 'type: frq\n[STEM]\nاشرح كيف تحل معادلة ax²+bx+c=0.\n[ANSWER]\nاستخدم الصيغة x=[-b±sqrt(b²-4ac)]/(2a)' },
            { id: 'frq_ai', name: '8. سؤال الإجابة الحرة بتصحيح AI (FRQ_AI)', desc: 'نفس FRQ، ولكنه مخصص للتصحيح التلقائي بواسطة AI.', format: 'type: frq_ai\nai_template_id: 123...\n[STEM]\nنص السؤال...\n[ANSWER]\nالإجابة النموذجية', exampleSimple: 'type: frq_ai\nai_template_id: 123\n[STEM]\nاكتب قصيدة.\n[ANSWER]\nالورد أحمر...', exampleLesson: 'type: frq_ai\nai_template_id: 456\n[STEM]\nحل المعادلة x²-4x+3=0 واشرح.\n[ANSWER]\n(x-1)(x-3)=0، جذور 1 و3.' },
            { id: 'input_box', name: '9. سؤال إدخال الرقم (Input Box)', desc: 'للأسئلة التي تكون إجابتها رقماً محدداً، مع إمكانية تحديد وحدة.', format: 'type: input_box\n[STEM]\nنص السؤال...\n[ANSWER]\nالقيمة | الوحدة', exampleSimple: 'type: input_box\n[STEM]\nما سرعة السيارة؟\n[ANSWER]\n100 | كم/س', exampleLesson: 'type: input_box\n[STEM]\nما تسارع الجاذبية؟\n[ANSWER]\n9.8 | م/ث²' },
            { id: 'multipart', name: '10. الأسئلة متعددة الأجزاء (Multi-part)', desc: 'هيكل لتجميع عدة أسئلة تحت مقدمة واحدة.', format: '[STATEMENT]\nالمقدمة المشتركة...\n\n[PART]\ntype: mcq\n[STEM]\nالسؤال الأول...\n\n[PART]\ntype: string\n[STEM]\nالسؤال الثاني...', exampleSimple: '', exampleLesson: '' }
        ];

        const tags = [
            { tag: '`[STEM]`', desc: 'يحتوي على نص السؤال الرئيسي.', example: '`[STEM]\nما هي صيغة حساب السرعة؟`' },
            { tag: '`[CHOICES]`', desc: 'يحتوي على قائمة الاختيارات.', example: '`[CHOICES]\n* v = d/t\n- v = d*t`' },
            { tag: '`[ANSWER]`', desc: 'يحتوي على الإجابة لأسئلة `String`, `FRQ`, و `Input Box`.', example: '`[ANSWER]\n9.8 | m/s²`' },
            { tag: '`[GAPS]`', desc: 'يحتوي على إجابات الفراغات بالترتيب، كل إجابة في سطر.', example: '`[GAPS]\nالتسارع\n9.8`' },
            { tag: '`[MATCHING_PAIRS]`', desc: 'يحتوي على أزواج التوصيل، مفصولة بـ `|`.', example: '`[MATCHING_PAIRS]\nنيوتن | القوة`' },
            { tag: '`[BLANK]`', desc: 'يمثل فراغاً داخل نص السؤال ليتم ملؤه.', example: '`القوة = الكتلة × [BLANK].`' },
            { tag: '`[STATEMENT]`', desc: 'يحتوي على المقدمة لسؤال متعدد الأجزاء.', example: '`[STATEMENT]\nبالنظر إلى قوانين الحركة...`' },
            { tag: '`[PART]`', desc: 'يعمل كفاصل بين أجزاء السؤال متعدد الأجزاء.', example: '`[PART]\ntype: mcq\n...`' },
            { tag: '`[U]...[/U]`', desc: 'يستخدم لوضع خط تحت النص للتأكيد.', example: '`[U]التسارع هو 9.8 م/ث²[/U]`' },
            { tag: '`---`', desc: '**فاصل إلزامي** بين كل سؤال والآخر.', example: '`---` (يوضع بعد كل سؤال مكتمل).' }
        ];

        const workflowSteps = [
            { title: 'السيناريو الأول: الطريقة القياسية (الأدق)', icon: '🎯', content: 'هي الطريقة الموصى بها وتضمن نتائج 100% صحيحة. تعتمد على كتابة السؤال باستخدام "وسوم" (Tags) بسيطة ومحددة مثل `type: mcq`, `[STEM]`, `[CHOICES]`, واستخدام `---` للفصل بين الأسئلة. بعد الكتابة، اضغط "تحليل ذكي" للمعاينة، ثم "تحويل لـ JSON" للنتيجة النهائية.' },
            { title: 'السيناريو الثاني: التعامل مع النصوص الجاهزة (بمساعدة AI)', icon: '✨', content: 'إذا كان لديك نص غير منظم (مثل نص من ملف Word)، الصقه في المحرر واضغط على زر "💎 تحسين بالـ AI". سيقوم الذكاء الاصطناعي بإعادة هيكلة النص بالتنسيق القياسي، وبعدها يمكنك المتابعة بالضغط على "تحليل ذكي". (هذه الميزة تتطلب مفتاح API).' },
            { title: 'السيناريو الثالث: توليد أسئلة من العدم', icon: '🚀', content: 'إذا كان لديك محتوى (مثل فقرة من درس) وتريد إنشاء أسئلة عنه، اضغط "🚀 توليد أسئلة". في النافذة الجديدة، الصق النص أو ارفع صورة، ثم حدد عدد ونوع الأسئلة المطلوبة. سيقوم الذكاء الاصطناعي بإنشاء الأسئلة وإضافتها للمحرر. (هذه الميزة تتطلب مفتاح API).' }
        ];

        const faqs = [
            { q: 'أزرار الذكاء الاصطناعي لا تعمل أو تعطي خطأ.', a: '99% من الوقت، المشكلة تكون في مفتاح الـ API. تأكد من أنك قمت بلصقه بشكل صحيح في الخانة المخصصة، وأنه لا توجد مسافات إضافية في البداية أو النهاية.' },
            { q: '"التحليل الذكي" يعطي نتائج غريبة أو خاطئة.', a: 'تحقق من النص الأصلي. هل نسيت وضع الفاصل `---` بين الأسئلة؟ هل هناك خطأ إملائي في أحد الوسوم (مثلاً `[STME]` بدلاً من `[STEM]`)؟' },
            { q: 'لا يظهر شيء عند الضغط على "تحويل لـ JSON".', a: 'تأكد من أنك قمت بالضغط على "تحليل ذكي" أولاً وأن لوحة المعاينة تعرض الأسئلة بشكل صحيح. الأداة لن تحول شيئاً لم يتم تحليله ومراجعته أولاً. ابحث عن علامة التحذير (⚠️) في المعاينة.' },
            { q: 'ما هو أفضل خيار لتصدير عدة أسئلة؟', a: 'استخدم دائماً زر "🗜️ تحميل كـ ZIP". هذا الخيار يقوم بتحميل ملف مضغوط يحتوي على كل سؤال في ملف .json منفصل بالإضافة إلى ملف CSV يلخصهم، وهو الخيار الأنسب للعمل المجمع.' }
        ];

        const advancedTopics = [
            { title: '"تحت الغطاء": كيف تعمل الأداة؟', content: 'تعمل الأداة عبر عدة مراحل: <strong>1. التقسيم:</strong> يتم تقسيم النص الكبير إلى كتل أسئلة منفصلة باستخدام الفاصل `---`. <strong>2. التحليل (Parsing):</strong> تستخدم الأداة تعابير نمطية (Regex) للتعرف على الوسوم مثل `type:` و `[STEM]` واستخلاص المحتوى الخاص بكل جزء. <strong>3. إدارة الحالة:</strong> يتم تخزين الأسئلة المحللة في الذاكرة (كائن JavaScript)، مما يسمح بتحديث المعاينة بشكل فوري. <strong>4. التحويل إلى JSON:</strong> عند الضغط على زر التحويل، لا يتم فقط تنسيق النص، بل يتم تحويل البيانات المخزنة إلى هيكل JSON النهائي المطلوب للنظام، مع إضافة بيانات وصفية (metadata) مثل اللغة والدولة.'},
            { title: 'نصائح للمحترفين وأسرار الإنتاجية', content: '<ul><li class="mb-2"><strong>التحرير المباشر:</strong> في المعاينة، يمكنك النقر مباشرة على أي اختيار في أسئلة MCQ/MRQ لتغيير الإجابة الصحيحة بدون تعديل النص يدوياً.</li><li class="mb-2"><strong>التعديل المجمع بـ CSV:</strong> محرر CSV هو أسرع طريقة لتعيين `Lesson ID` أو `Question ID` لعشرات الأسئلة دفعة واحدة.</li><li class="mb-2"><strong>الحفظ التلقائي:</strong> يتم حفظ عملك في `localStorage` بالمتصفح، لذا عملك آمن إذا أغلقت الصفحة، لكنه يقتصر على هذا المتصفح وهذا الجهاز فقط.</li><li class="mb-2"><strong>اختصار الإغلاق:</strong> استخدم مفتاح `Esc` لإغلاق أي نافذة منبثقة (modal) فوراً.</li></ul>'},
            { title: 'دليل التعامل مع المعادلات (LaTeX)', content: 'الأداة تستخدم مكتبة MathLive لعرض وتعديل المعادلات. <strong>الفرق الأساسي:</strong> استخدم backticks فردية (` `) للمعادلات السطرية (inline) التي تظهر وسط النص، واستخدم backticks مزدوجة (`` ``) للمعادلات الكبيرة التي تظهر في سطر منفصل (display). يمكنك النقر على أي معادلة في المعاينة لفتح محرر مرئي سهل الاستخدام.'},
            { title: 'شرح آلية التحقق من الصحة (Validation)', content: 'أيقونة التحذير (⚠️) تظهر عندما تكتشف الأداة خطأ منطقياً في سؤالك. يتم هذا عبر فحص فوري للنص. <strong>أشهر الأخطاء التي يتم كشفها:</strong> سؤال MCQ بدون أي إجابة صحيحة (*)، أو سؤال توصيل (Matching) يحتوي على سطر لا يفصل بينه الرمز `|`. هذه الميزة تساعد على منع الأخطاء قبل تصدير الملف النهائي.'},
            { title: 'هيكل ملف الـ ZIP المُصدَّر', content: 'عند استخدام خيار "تحميل كـ ZIP"، ستحصل على ملف مضغوط يحتوي على: <br><strong>1. مجلد `JSONS`:</strong> بداخله كل سؤال كملف `.json` منفصل، ومسمى بالـ ID الخاص به. <br><strong>2. ملف `question_set_summary.csv`:</strong> جدول بيانات يلخص كل الأسئلة وبياناتها الوصفية في مكان واحد لتسهيل المراجعة.'}
        ];

        const translations = {
            ar: {
                mainTitle: "🚀 الدليل التفاعلي الكامل لمحول الأسئلة الذكي",
                mainSubtitle: "مرجعك الشامل لإتقان الأداة، من فهم أنواع الأسئلة واستخدام الوسوم، إلى توليد التنسيقات باستخدام البرومبتات الاحترافية.",
                langSwitcher: "English",
                tabs: [
                    { id: 'guide', icon: '<i class="fas fa-list-alt"></i>', text: 'الأنواع والوسوم' },
                    { id: 'workflow', icon: '<i class="fas fa-project-diagram"></i>', text: 'خطوات الاستخدام' },
                    { id: 'advanced', icon: '<i class="fas fa-cogs"></i>', text: 'ميزات متقدمة' },
                    { id: 'prompts', icon: '<i class="fas fa-magic"></i>', text: 'البرومبتات' },
                    { id: 'faq', icon: '<i class="fas fa-question-circle"></i>', text: 'أسئلة شائعة' }
                ],
                guideTitle1: '<i class="fas fa-list-alt text-purple-600"></i>أنواع الأسئلة المدعومة',
                guideTitle2: '<i class="fas fa-tags text-purple-600"></i>مرجع الوسوم (Tags) الكامل',
                tagsTableHeader: ['الوسم', 'الوصف', 'مثال من درس (فيزياء: "الحركة")'],
                workflowTitle: "خطوات الاستخدام وسيناريوهات العمل",
                advancedTitle: "ميزات متقدمة وتفاصيل تقنية",
                promptsTitle1: "الـ Prompt الرئيسي الشامل (Master Prompt)",
                promptsSubtitle1: "الأقوى والأكثر مرونة. استخدمه لتحويل دفعة من الأسئلة المختلطة من أنواع مختلفة في مرة واحدة.",
                promptsTitle2: "Prompts مخصصة لكل نوع",
                promptsSubtitle2: "استخدم هذه الأوامر المخصصة إذا كنت تريد تحويل مجموعة من أسئلة من نوع واحد فقط لنتائج أكثر دقة.",
                faqTitle: "أسئلة شائعة وحل المشكلات",
                footerP1: "تم تصميم هذا الدليل لتسهيل استخدام \"محول الأسئلة الذكي\".",
                footerP2: "© 2025 - بالتوفيق في عملكم!",
                copyBtnText: "نسخ",
                copiedBtnText: "تم النسخ!",
                exampleSimple: "مثال بسيط:",
                exampleLesson: "مثال من درس:",
                noExample: "لا يوجد مثال تطبيقي لهذا الهيكل",
                questionTypes: questionTypes.map(q => ({...q})),
                tags: tags,
                workflowSteps: workflowSteps,
                faqs: faqs,
                advancedTopics: advancedTopics,
                masterPrompt: `أنت خبير في تنسيق المحتوى الأكاديمي. مهمتك هي تحويل نصوص الأسئلة الخام وغير المنظمة بدقة إلى تنسيق قياسي يستخدم الوسوم.

**التعليمات الأساسية:**
1.  **اكتشف كل سؤال** في النص المقدم.
2.  **حدد نوع السؤال تلقائيًا** لكل سؤال من القائمة التالية: \`mcq\`, \`mrq\`, \`matching\`, \`gapText\`, \`oq\`, \`string\`, \`frq\`, \`frq_ai\`, \`input_box\`.
3.  **نسّق كل سؤال** وفقًا للقواعد الصارمة أدناه.
4.  **افصل بين كل كتلة سؤال مكتملة** باستخدام \`---\`.

**قواعد التنسيق حسب نوع السؤال:**

* **لـ MCQ/MRQ:**
   * ابدأ بـ \`type: mcq\` أو \`type: mrq\`.
   * استخدم \`[STEM]\` لنص السؤال.
   * استخدم \`[CHOICES]\` للخيارات.
   * ضع علامة \`*\` قبل الإجابة الصحيحة الوحيدة لـ MCQ.
   * ضع علامة \`*\` قبل كل الإجابات الصحيحة لـ MRQ.
   * ضع علامة \`-\` قبل كل الإجابات الخاطئة.

* **لـ Matching:**
   * ابدأ بـ \`type: matching\`.
   * استخدم \`[STEM]\` للتوجيه.
   * استخدم \`[MATCHING_PAIRS]\` للأزواج.
   * افصل بين كل زوج بحرف \`|\` (مثال: \`مصطلح | تعريف\`).

* **لـ GapText:**
   * ابدأ بـ \`type: gapText\`.
   * في \`[STEM]\`، ابحث عن أي تسلسل طويل من الشرطات السفلية أو العادية (مثل \`____\` أو \`ــــــــــــ\`) و**استبدله بوسم \`[BLANK]\`**.
   * اذكر الإجابات الصحيحة بالترتيب تحت \`[GAPS]\`، كل واحدة في سطر جديد.

* **لـ Ordering (OQ):**
   * ابدأ بـ \`type: oq\`.
   * استخدم \`[STEM]\` للتوجيه.
   * تحت \`[CHOICES]\`، اذكر العناصر **بالترتيب الصحيح**، كل منها مسبوق بـ \`-\`.

* **لـ String/FRQ/FRQ_AI:**
   * ابدأ بالنوع المناسب (\`type: string\`، إلخ).
   * استخدم \`[STEM]\` للسؤال.
   * ضع الإجابة النموذجية تحت \`[ANSWER]\`.

* **لـ Input Box:**
   * ابدأ بـ \`type: input_box\`.
   * استخدم \`[STEM]\` للسؤال.
   * تحت \`[ANSWER]\`، قدم القيمة، متبوعة بـ \`|\`، ثم الوحدة (مثال: \`9.8 | م/ث²\`).

**النص المطلوب تحويله:**
\`\`\`
[!! الصق هنا نص الأسئلة الخام !!]
\`\`\`

**الناتج المنسق:**`,
                specificPrompts: [
                    { title: '1. لتحويل سؤال اختيار من متعدد (MCQ)', code: 'أنت خبير تنسيق. حوّل النص الخام التالي إلى تنسيق MCQ قياسي.\n- يجب أن يبدأ التنسيق بـ `type: mcq`.\n- استخدم `[STEM]` للسؤال.\n- استخدم `[CHOICES]` للخيارات.\n- يجب أن يبدأ الخيار الصحيح الوحيد بـ `*`.\n- يجب أن تبدأ جميع الخيارات الخاطئة الأخرى بـ `-`.\n- افصل الكتلة المنسقة النهائية بـ `---`.\n\nالنص الخام:\n[!! الصق هنا سؤال الـ MCQ الخام !!]\n\nالنص المنسق:' },
                    { title: '2. لتحويل سؤال ملء الفراغات (GapText)', code: 'أنت خبير تنسيق. حوّل النص الخام التالي إلى تنسيق GapText قياسي.\n- يجب أن يبدأ التنسيق بـ `type: gapText`.\n- في `[STEM]`، استبدل أي تسلسل طويل من الشرطات العادية أو السفلية (مثل `ــــــــــــ` أو `____`) بوسم `[BLANK]`.\n- اذكر الإجابات الصحيحة بالترتيب تحت وسم `[GAPS]`، كل منها في سطر جديد.\n- افصل الكتلة المنسقة النهائية بـ `---`.\n\nالنص الخام:\n[!! الصق هنا سؤال ملء الفراغات الخام !!]\n\nالنص المنسق:' },
                    { title: '3. لتحويل سؤال توصيل (Matching)', code: 'أنت خبير تنسيق. حوّل النص الخام التالي إلى تنسيق Matching قياسي.\n- يجب أن يبدأ التنسيق بـ `type: matching`.\n- استخدم `[STEM]` للتوجيه.\n- ضع الأزواج المتطابقة بشكل صحيح تحت `[MATCHING_PAIRS]`.\n- يجب أن يكون كل زوج في سطر جديد، مفصولاً بحرف `|`.\n- افصل الكتلة المنسقة النهائية بـ `---`.\n\nالنص الخام:\n[!! الصق هنا سؤال التوصيل الخام !!]\n\nالنص المنسق:' },
                    { title: '4. لتحويل سؤال ترتيب (OQ)', code: 'أنت خبير تنسيق. حوّل النص الخام التالي إلى تنسيق سؤال الترتيب (OQ) قياسي.\n- يجب أن يبدأ التنسيق بـ `type: oq`.\n- استخدم `[STEM]` للتوجيه.\n- تحت `[CHOICES]`، اذكر جميع العناصر بالترتيب الصحيح.\n- يجب أن يكون كل عنصر في القائمة مسبوقًا بـ `-`.\n- افصل الكتلة المنسقة النهائية بـ `---`.\n\nالنص الخام:\n[!! الصق هنا سؤال الترتيب الخام !!]\n\nالنص المنسق:' }
                ]
            },
            en: {
                mainTitle: "🚀 The Complete Interactive Guide for the Smart Question Converter",
                mainSubtitle: "Your comprehensive reference for mastering the tool, from understanding question types and tags to generating formats using professional prompts.",
                langSwitcher: "العربية",
                tabs: [
                    { id: 'guide', icon: '<i class="fas fa-list-alt"></i>', text: 'Types & Tags' },
                    { id: 'workflow', icon: '<i class="fas fa-project-diagram"></i>', text: 'Workflow' },
                    { id: 'advanced', icon: '<i class="fas fa-cogs"></i>', text: 'Advanced Features' },
                    { id: 'prompts', icon: '<i class="fas fa-magic"></i>', text: 'Prompts' },
                    { id: 'faq', icon: '<i class="fas fa-question-circle"></i>', text: 'FAQ' }
                ],
                guideTitle1: '<i class="fas fa-list-alt text-purple-600"></i>Supported Question Types',
                guideTitle2: '<i class="fas fa-tags text-purple-600"></i>Complete Tags Reference',
                tagsTableHeader: ['Tag', 'Description', 'Example from Physics: "Motion"'],
                workflowTitle: "Workflow and Usage Scenarios",
                advancedTitle: "Advanced Features & Technical Details",
                promptsTitle1: "Master Prompt",
                promptsSubtitle1: "The most powerful and flexible prompt. Use it to convert a mixed batch of questions of different types at once.",
                promptsTitle2: "Specific Prompts for Each Type",
                promptsSubtitle2: "Use these custom prompts if you want to convert a set of questions of a single type for more accurate results.",
                faqTitle: "Frequently Asked Questions & Troubleshooting",
                footerP1: "This guide was designed to facilitate the use of the \"Smart Question Converter\".",
                footerP2: "© 2025 - Good luck with your work!",
                copyBtnText: "Copy",
                copiedBtnText: "Copied!",
                exampleSimple: "Simple Example:",
                exampleLesson: "Lesson Example:",
                noExample: "No practical example for this structure",
                questionTypes: [
                     { id: 'mcq', name: '1. Multiple Choice Question (MCQ)', desc: 'Used when there is only one correct answer among several options.', exampleLesson: 'type: mcq\n[STEM]\nWhat is the general form of a quadratic function?\n[CHOICES]\n- f(x) = ax + b\n* f(x) = ax² + bx + c\n- f(x) = a/x' },
                     { id: 'mrq', name: '2. Multiple Response Question (MRQ)', desc: 'Used when there can be more than one correct answer.', exampleLesson: 'type: mrq\n[STEM]\nWhat are the properties of a quadratic function?\n[CHOICES]\n* It has a vertex (a peak or a valley)\n- It is always increasing\n* It intersects the y-axis once' },
                     { id: 'matching', name: '3. Matching Question', desc: 'Used to link items from two groups.', exampleLesson: 'type: matching\n[STEM]\nMatch the function to its description:\n[MATCHING_PAIRS]\nf(x)=x² | Quadratic\nf(x)=2x | Linear' },
                     { id: 'gapText', name: '4. Gapped Text Question', desc: 'Used to test knowledge of specific words within a context.', exampleLesson: 'type: gapText\n[STEM]\nThe function f(x) = x² + [BLANK]x + 4 has [BLANK] roots.\n[GAPS]\n4\nreal and equal' },
                     { id: 'oq', name: '5. Ordering Question', desc: 'Used to arrange a set of items according to a specific criterion.', exampleLesson: 'type: oq\n[STEM]\nOrder the steps to solve a quadratic function:\n[CHOICES]\n- Calculate the discriminant\n- Calculate the roots using the formula\n- Draw the graph' },
                     { id: 'string', name: '6. String Question', desc: 'For questions requiring a short, very specific answer.', exampleLesson: 'type: string\n[STEM]\nWhat is the coefficient of a in f(x)=3x²?\n[ANSWER]\n3' },
                     { id: 'frq', name: '7. Free Response Question (FRQ)', desc: 'For essay questions requiring a long, detailed answer.', exampleLesson: 'type: frq\n[STEM]\nExplain how to solve ax²+bx+c=0.\n[ANSWER]\nUse the formula x=[-b±sqrt(b²-4ac)]/(2a)' },
                     { id: 'frq_ai', name: '8. AI-Graded Free Response (FRQ_AI)', desc: 'Same as FRQ, but intended for automatic grading by an AI.', exampleLesson: 'type: frq_ai\nai_template_id: 456\n[STEM]\nSolve the equation x²-4x+3=0 and explain.\n[ANSWER]\n(x-1)(x-3)=0, roots are 1 and 3.' },
                     { id: 'input_box', name: '9. Input Box Question', desc: 'For questions whose answer is a specific number, with an optional unit.', exampleLesson: 'type: input_box\n[STEM]\nWhat is the acceleration of gravity?\n[ANSWER]\n9.8 | m/s²' },
                     { id: 'multipart', name: '10. Multi-part Questions', desc: 'A structure to group several questions under a single introduction.' }
                ].map(en_q => ({...questionTypes.find(q => q.id === en_q.id), ...en_q})),
                tags: [
                    { tag: '`[STEM]`', desc: 'Contains the main text of the question.', example: '`[STEM]\nWhat is the formula for velocity?`' },
                    { tag: '`[CHOICES]`', desc: 'Contains the list of options.', example: '`[CHOICES]\n* v = d/t\n- v = d*t`' },
                    { tag: '`[ANSWER]`', desc: 'Contains the answer for `String`, `FRQ`, and `Input Box` questions.', example: '`[ANSWER]\n9.8 | m/s²`' },
                    { tag: '`[GAPS]`', desc: 'Contains the gap-fill answers in order, each on a new line.', example: '`[GAPS]\nAcceleration\n9.8`' },
                    { tag: '`[MATCHING_PAIRS]`', desc: 'Contains the matching pairs, separated by `|`.', example: '`[MATCHING_PAIRS]\nNewton | Force`' },
                    { tag: '`[BLANK]`', desc: 'Represents a blank space within the question text to be filled.', example: '`Force = mass × [BLANK].`' },
                    { tag: '`[STATEMENT]`', desc: 'Contains the introduction for a multi-part question.', example: '`[STATEMENT]\nConsidering the laws of motion...`' },
                    { tag: '`[PART]`', desc: 'Acts as a separator between parts of a multi-part question.', example: '`[PART]\ntype: mcq\n...`' },
                    { tag: '`[U]...[/U]`', desc: 'Used to underline text for emphasis.', example: '`[U]Acceleration is 9.8 m/s²[/U]`' },
                    { tag: '`---`', desc: '**Mandatory separator** between each question.', example: '`---` (placed after each complete question).' }
                ],
                workflowSteps: [
                    { title: 'Scenario 1: The Standard Method (Most Accurate)', icon: '🎯', content: 'This is the recommended method and guarantees 100% correct results. It relies on writing the question using simple, specific "Tags" like `type: mcq`, `[STEM]`, `[CHOICES]`, and using `---` to separate questions. After writing, click "Smart Analyze" to preview, then "Convert to JSON" for the final result.' },
                    { title: 'Scenario 2: Handling Raw Text (with AI Assistance)', icon: '✨', content: 'If you have unstructured text (e.g., from a Word file), paste it into the editor and click the "💎 Enhance with AI" button. The AI will restructure the text into the standard format, after which you can proceed by clicking "Smart Analyze". (This feature requires an API key).' },
                    { title: 'Scenario 3: Generating Questions from Scratch', icon: '🚀', content: 'If you have content (like a lesson paragraph) and want to create questions from it, click "🚀 Generate Questions". In the new window, paste the text or upload an image, then specify the number and type of questions desired. The AI will generate the questions and add them to the editor. (This feature requires an API key).' }
                ],
                faqs: [
                    { q: 'The AI buttons are not working or give an error.', a: '99% of the time, the issue is with the API key. Ensure you have pasted it correctly in the designated field and that there are no extra spaces at the beginning or end.' },
                    { q: '"Smart Analyze" gives strange or incorrect results.', a: 'Check the original text. Did you forget to put the `---` separator between questions? Is there a typo in one of the tags (e.g., `[STME]` instead of `[STEM]`)?' },
                    { q: 'Nothing appears when I click "Convert to JSON".', a: 'Make sure you have clicked "Smart Analyze" first and that the preview pane is displaying the questions correctly. The tool will not convert anything that has not been analyzed and reviewed first. Look for the warning icon (⚠️) in the preview.' },
                    { q: 'What is the best option for exporting multiple questions?', a: 'Always use the "🗜️ Download as ZIP" button. This option downloads a compressed file containing each question as a separate .json file, plus a summary CSV file, which is the most suitable option for bulk work.' }
                ],
                advancedTopics: [
                    { title: '"Under the Hood": How Does the Tool Work?', content: 'The tool operates in several stages: <strong>1. Splitting:</strong> The full text is divided into separate question blocks using the `---` separator. <strong>2. Parsing:</strong> The tool uses regular expressions (Regex) to identify tags like `type:` and `[STEM]` and extract the content for each part. <strong>3. State Management:</strong> The parsed questions are stored in memory (as a JavaScript object), allowing for instant preview updates. <strong>4. JSON Conversion:</strong> When you click the convert button, the stored data is transformed into the final JSON structure required by the system, adding metadata like language and country.'},
                    { title: 'Pro Tips & Productivity Secrets', content: '<ul><li class="mb-2"><strong>Direct Editing:</strong> In the preview, you can click directly on any choice in MCQ/MRQ questions to change the correct answer without manually editing the text.</li><li class="mb-2"><strong>Bulk Editing with CSV:</strong> The CSV editor is the fastest way to assign a `Lesson ID` or `Question ID` to dozens of questions at once.</li><li class="mb-2"><strong>Auto-Save:</strong> Your work is automatically saved in the browser\'s `localStorage`, so it\'s safe if you close the page, but it\'s limited to that browser and device only.</li><li class="mb-2"><strong>Closing Shortcut:</strong> Use the `Esc` key to instantly close any pop-up window (modal).</li></ul>'},
                    { title: 'Guide to Handling Equations (LaTeX)', content: 'The tool uses the MathLive library to display and edit equations. <strong>The key difference:</strong> Use single backticks (` `) for inline equations that appear within the text, and use double backticks (`` ``) for larger equations that appear on their own line (display). You can click on any equation in the preview to open an easy-to-use visual editor.'},
                    { title: 'How Validation Works', content: 'The warning icon (⚠️) appears when the tool detects a logical error in your question. This is done via an instant text check. <strong>The most common detected errors:</strong> An MCQ question with no correct answer (*), or a Matching question with a line not separated by the `|` symbol. This feature helps prevent errors before exporting the final file.'},
                    { title: 'Structure of the Exported ZIP File', content: 'When using the "Download as ZIP" option, you will get a compressed file containing: <br><strong>1. `JSONS` folder:</strong> Inside, each question is a separate `.json` file, named with its ID. <br><strong>2. `question_set_summary.csv` file:</strong> A spreadsheet that summarizes all questions and their metadata in one place for easy review.'}
                ],
                masterPrompt: `You are an expert academic content formatter. Your task is to meticulously convert raw, unstructured question text into a standardized, tagged format.

**Core Instructions:**
1.  **Detect every question** in the provided text.
2.  **Auto-detect the question type** for each question from the following list: \`mcq\`, \`mrq\`, \`matching\`, \`gapText\`, \`oq\`, \`string\`, \`frq\`, \`frq_ai\`, \`input_box\`.
3.  **Format EACH question** according to the strict rules below.
4.  **Separate each complete question block** with \`---\`.

**Formatting Rules by Question Type:**

* **For MCQ/MRQ:**
   * Start with \`type: mcq\` or \`type: mrq\`.
   * Use \`[STEM]\` for the question text.
   * Use \`[CHOICES]\` for the options.
   * Prefix the single correct answer with \`*\` for MCQ.
   * Prefix ALL correct answers with \`*\` for MRQ.
   * Prefix all incorrect answers with \`-\`.

* **For Matching:**
   * Start with \`type: matching\`.
   * Use \`[STEM]\` for the instruction.
   * Use \`[MATCHING_PAIRS]\` for the pairs.
   * Separate each pair with a \`|\` character (e.g., \`Term | Definition\`).

* **For GapText:**
   * Start with \`type: gapText\`.
   * In the \`[STEM]\`, find any long underscore/dash sequences (like \`____\` or \`ــــــــــــ\`) and **replace them with the \`[BLANK]\` tag**.
   * List the correct answers in order under \`[GAPS]\`, each on a new line.

* **For Ordering (OQ):**
   * Start with \`type: oq\`.
   * Use \`[STEM]\` for the instruction.
   * Under \`[CHOICES]\`, list the items **in the correct order**, each prefixed with \`-\`.

* **For String/FRQ/FRQ_AI:**
   * Start with the appropriate type (\`type: string\`, etc.).
   * Use \`[STEM]\` for the question.
   * Place the model answer under \`[ANSWER]\`.

* **For Input Box:**
   * Start with \`type: input_box\`.
   * Use \`[STEM]\` for the question.
   * Under \`[ANSWER]\`, provide the value, followed by \`|\`, then the unit (e.g., \`9.8 | m/s²\`).

**Input Text to Convert:**
\`\`\`
[!! Paste raw question text here !!]
\`\`\`

**Formatted Output:**`,
                specificPrompts: [
                    { title: '1. To convert an MCQ question', code: 'You are a formatting expert. Convert the following raw text into a standard MCQ format.\n- The format must start with `type: mcq`.\n- Use `[STEM]` for the question.\n- Use `[CHOICES]` for the options.\n- The single correct option must start with `*`.\n- All other incorrect options must start with `-`.\n- Separate the final formatted block with `---`.\n\nRAW TEXT:\n[!! Paste the raw MCQ question here !!]\n\nFORMATTED TEXT:' },
                    { title: '2. To convert a GapText question', code: 'You are a formatting expert. Convert the following raw text into a standard GapText format.\n- The format must start with `type: gapText`.\n- In the `[STEM]`, replace any long dash or underscore sequences (e.g., `ــــــــــــ` or `____`) with the `[BLANK]` tag.\n- List the correct answers in order under the `[GAPS]` tag, each on a new line.\n- Separate the final formatted block with `---`.\n\nRAW TEXT:\n[!! Paste the raw GapText question here !!]\n\nFORMATTED TEXT:' },
                    { title: '3. To convert a Matching question', code: 'You are a formatting expert. Convert the following raw text into a standard Matching format.\n- The format must start with `type: matching`.\n- Use `[STEM]` for the instruction.\n- Place the correctly matched pairs under `[MATCHING_PAIRS]`.\n- Each pair must be on a new line, separated by a `|` character.\n- Separate the final formatted block with `---`.\n\nRAW TEXT:\n[!! Paste the raw Matching question here !!]\n\nFORMATTED TEXT:' },
                    { title: '4. To convert an Ordering question (OQ)', code: 'You are a formatting expert. Convert the following raw text into a standard Ordering Question (OQ) format.\n- The format must start with `type: oq`.\n- Use `[STEM]` for the instruction.\n- Under `[CHOICES]`, list all items IN THE CORRECT ORDER.\n- Each item in the list must be prefixed with `-`.\n- Separate the final formatted block with `---`.\n\nRAW TEXT:\n[!! Paste the raw Ordering question here !!]\n\nFORMATTED TEXT:' }
                ]
            }
        };

        let currentLang = 'ar';

        function renderContent(lang) {
            const T = translations[lang];
            const tabsContainer = document.getElementById('tabs');

            // UX Improvement: Preserve active tab across language switches
            const activeTabEl = tabsContainer.querySelector('.active');
            const activeTabId = activeTabEl ? activeTabEl.dataset.tab : 'guide';

            // Set document lang and dir
            document.documentElement.lang = lang;
            document.documentElement.dir = lang === 'ar' ? 'rtl' : 'ltr';

            // Update static text
            document.getElementById('main-title').textContent = T.mainTitle;
            document.getElementById('main-subtitle').textContent = T.mainSubtitle;
            document.getElementById('lang-switcher').innerHTML = `<i class="fas fa-language"></i><span>${T.langSwitcher}</span>`;
            document.getElementById('guide-title-1').innerHTML = T.guideTitle1;
            document.getElementById('guide-title-2').innerHTML = T.guideTitle2;
            document.getElementById('workflow-title').textContent = T.workflowTitle;
            document.getElementById('advanced-title').textContent = T.advancedTitle;
            document.getElementById('prompts-title-1').textContent = T.promptsTitle1;
            document.getElementById('prompts-subtitle-1').textContent = T.promptsSubtitle1;
            document.getElementById('prompts-title-2').textContent = T.promptsTitle2;
            document.getElementById('prompts-subtitle-2').textContent = T.promptsSubtitle2;
            document.getElementById('faq-title').textContent = T.faqTitle;
            document.getElementById('footer-p1').textContent = T.footerP1;
            document.getElementById('footer-p2').textContent = T.footerP2;

            // Render tabs
            tabsContainer.innerHTML = '';
            T.tabs.forEach((tab) => {
                const button = document.createElement('button');
                button.dataset.tab = tab.id;
                button.className = `tab-btn flex items-center justify-center gap-2 p-3 rounded-lg border-2 border-transparent transition-all duration-300`;
                button.innerHTML = `${tab.icon}<span>${tab.text}</span>`;
                tabsContainer.appendChild(button);
            });

            // Restore active tab
            document.querySelector(`#tabs .tab-btn[data-tab="${activeTabId}"]`).classList.add('active');
            document.querySelector('#tab-contents .active').classList.remove('active');
            document.getElementById(activeTabId).classList.add('active');

            // Re-attach tab listener
            tabsContainer.addEventListener('click', handleTabClick);

            // Render accordion
            const accordionContainer = document.getElementById('accordion-container');
            accordionContainer.innerHTML = '';
            T.questionTypes.forEach(q => { 
                const item = document.createElement('div');
                item.className = 'border border-slate-200 rounded-lg overflow-hidden glow-card';
                item.innerHTML = `
                    <button class="accordion-header w-full text-right p-4 bg-slate-50 hover:bg-slate-100 flex justify-between items-center transition">
                        <span class="font-bold text-lg text-slate-700">${q.name}</span>
                        <i class="fas fa-chevron-down accordion-icon text-purple-600 transition-transform duration-300"></i>
                    </button>
                    <div class="accordion-content bg-white p-4 border-t border-slate-200" style="display: none;">
                        <p class="text-slate-600 mb-4">${q.desc}</p>
                        <div class="grid md:grid-cols-2 gap-4 text-sm">
                            <div>
                                <h4 class="font-semibold mb-2 text-purple-700">${T.exampleSimple}</h4>
                                <pre class="bg-slate-100 p-3 rounded-md text-slate-800 whitespace-pre-wrap"><code>${q.exampleSimple || T.noExample}</code></pre>
                            </div>
                            <div>
                                <h4 class="font-semibold mb-2 text-purple-700">${T.exampleLesson}</h4>
                                <pre class="bg-slate-100 p-3 rounded-md text-slate-800 whitespace-pre-wrap"><code>${q.exampleLesson || T.noExample}</code></pre>
                            </div>
                        </div>
                    </div>
                `;
                accordionContainer.appendChild(item);
            });

            // Render tags table
            const tagsTableHead = document.getElementById('tags-table-head');
            tagsTableHead.innerHTML = `
                <tr class="bg-slate-100">
                    <th class="p-3 font-bold uppercase text-slate-600 border-b border-slate-200">${T.tagsTableHeader[0]}</th>
                    <th class="p-3 font-bold uppercase text-slate-600 border-b border-slate-200">${T.tagsTableHeader[1]}</th>
                    <th class="p-3 font-bold uppercase text-slate-600 border-b border-slate-200">${T.tagsTableHeader[2]}</th>
                </tr>`;
            const tagsTableBody = document.getElementById('tags-table-body');
            tagsTableBody.innerHTML = '';
            T.tags.forEach(t => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-slate-50';
                row.innerHTML = `
                    <td class="p-3 border-b border-slate-200 font-mono font-semibold text-purple-700">${t.tag}</td>
                    <td class="p-3 border-b border-slate-200 text-slate-600">${t.desc}</td>
                    <td class="p-3 border-b border-slate-200 text-slate-500 text-sm" dir="ltr"><pre class="bg-slate-100 p-2 rounded"><code>${t.example}</code></pre></td>
                `;
                tagsTableBody.appendChild(row);
            });

            // Render workflow
            const workflowContainer = document.getElementById('workflow-container');
            workflowContainer.innerHTML = '';
            T.workflowSteps.forEach(step => {
                const div = document.createElement('div');
                div.className = 'p-4 border-r-4 border-purple-500 bg-purple-50 rounded-lg glow-card';
                div.innerHTML = `
                    <h3 class="font-bold text-xl mb-2 text-purple-900 flex items-center gap-3"><span class="text-3xl">${step.icon}</span>${step.title}</h3>
                    <p class="text-purple-800">${step.content}</p>
                `;
                workflowContainer.appendChild(div);
            });

            // Render advanced topics
            const advancedAccordion = document.getElementById('advanced-accordion');
            advancedAccordion.innerHTML = '';
            T.advancedTopics.forEach(topic => { 
                const div = document.createElement('div');
                div.className = 'border border-slate-200 rounded-lg glow-card';
                div.innerHTML = `
                    <button class="accordion-header w-full text-right p-4 flex justify-between items-center">
                        <span class="font-semibold text-slate-700">${topic.title}</span>
                        <i class="fas fa-chevron-down accordion-icon text-slate-500 transition-transform duration-300"></i>
                    </button>
                    <div class="accordion-content p-4 pt-0 text-slate-600" style="display: none;">
                        <div class="prose max-w-none">${topic.content}</div>
                    </div>
                `;
                advancedAccordion.appendChild(div);
            });

            // Render master prompt
            document.getElementById('master-prompt-container').innerHTML = `
                <div class="prompt-code bg-slate-800 rounded-xl text-white p-4 glow-card">
                    <button class="copy-btn" onclick="copyCode(this)">
                        <i class="far fa-copy"></i>
                        <span>${T.copyBtnText}</span>
                    </button>
                    <pre class="whitespace-pre-wrap text-sm" dir="ltr"><code>${T.masterPrompt}</code></pre>
                </div>`;

            // Render specific prompts
            const specificPromptsContainer = document.getElementById('specific-prompts-container');
            specificPromptsContainer.innerHTML = '';
            T.specificPrompts.forEach(p => {
                const div = document.createElement('div');
                div.innerHTML = `
                    <h3 class="font-bold mb-2 text-lg">${p.title}</h3>
                    <div class="prompt-code bg-slate-800 rounded-xl text-white p-4 glow-card">
                        <button class="copy-btn" onclick="copyCode(this)">
                            <i class="far fa-copy"></i>
                            <span>${T.copyBtnText}</span>
                        </button>
                        <pre class="whitespace-pre-wrap text-sm" dir="ltr"><code>${p.code}</code></pre>
                    </div>
                `;
                specificPromptsContainer.appendChild(div);
            });

            // Render FAQ
            const faqContainer = document.getElementById('faq-container');
            faqContainer.innerHTML = '';
            T.faqs.forEach(faq => {
                const div = document.createElement('div');
                div.className = 'border border-slate-200 rounded-lg glow-card';
                div.innerHTML = `
                    <button class="accordion-header w-full text-right p-4 flex justify-between items-center">
                        <span class="font-semibold text-slate-700">${faq.q}</span>
                        <i class="fas fa-chevron-down accordion-icon text-slate-500 transition-transform duration-300"></i>
                    </button>
                    <div class="accordion-content p-4 pt-0 text-slate-600" style="display: none;">
                        <p>${faq.a}</p>
                    </div>
                `;
                faqContainer.appendChild(div);
            });

            // Re-attach accordion listeners
            document.querySelectorAll('.accordion-header').forEach(header => {
                header.addEventListener('click', handleAccordionClick);
            });
        }

        function handleTabClick(e) {
            const tabButton = e.target.closest('.tab-btn');
            if (!tabButton) return;

            document.querySelector('#tabs .active').classList.remove('active');
            tabButton.classList.add('active');

            document.querySelector('#tab-contents .active').classList.remove('active');
            document.getElementById(tabButton.dataset.tab).classList.add('active');
        }

        function handleAccordionClick(e) {
            const header = e.currentTarget;
            const content = header.nextElementSibling;
            const isActive = header.classList.contains('active');

            if (!isActive) {
                header.classList.add('active');
                content.style.display = 'block';
            } else {
                header.classList.remove('active');
                content.style.display = 'none';
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            currentLang = localStorage.getItem('guideLang') || 'ar';
            renderContent(currentLang);

            document.getElementById('lang-switcher').addEventListener('click', () => {
                currentLang = currentLang === 'ar' ? 'en' : 'ar';
                localStorage.setItem('guideLang', currentLang);
                renderContent(currentLang);
            });
        });

        function copyCode(button) {
            const pre = button.nextElementSibling;
            const code = pre.querySelector('code');
            const textToCopy = code.innerText;

            const tempTextarea = document.createElement('textarea');
            tempTextarea.value = textToCopy;
            document.body.appendChild(tempTextarea);
            tempTextarea.select();

            try {
                document.execCommand('copy');
                const originalText = button.querySelector('span').textContent;
                button.querySelector('span').textContent = translations[currentLang].copiedBtnText;
                button.style.backgroundColor = '#10b981';
                setTimeout(() => {
                    button.querySelector('span').textContent = translations[currentLang].copyBtnText;
                    button.style.backgroundColor = '';
                }, 2000);
            } catch (err) {
                console.error('Fallback: Oops, unable to copy', err);
            }

            document.body.removeChild(tempTextarea);
        }
    </script>
</body>
</html>
